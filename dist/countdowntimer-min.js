"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var CountdownTimer=function e(){var t,n,i,r,o,s,_,a,l,h,u,d,m,c=this,f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),_defineProperty(this,"button_text","Submit"),_defineProperty(this,"hide_on_start",!0),_defineProperty(this,"submit_verify_message","Do you really want to submit?"),_defineProperty(this,"onSubmitError",this._showError),_defineProperty(this,"onGetTimerError",this._showError),_defineProperty(this,"warning_threshold",600),_defineProperty(this,"warning_message",""),_defineProperty(this,"onShowWarning",function(){return alert(c.warning_message)}),_defineProperty(this,"alert_threshold",60),_defineProperty(this,"alert_message",""),_defineProperty(this,"onShowAlert",function(){return alert(c.alert_message)}),_defineProperty(this,"_element",null),_defineProperty(this,"_btn",null),_defineProperty(this,"_submitting",!1),_defineProperty(this,"_getting_timer",!1),_defineProperty(this,"_warning_message_is_shown",!1),_defineProperty(this,"_alert_message_is_shown",!1),_defineProperty(this,"_defineElements",function(e){if(!c._element){if(!e)return void c._showWarn("Please, define container option or customElement");var t=document.querySelector(e);if(!t)return void c._showWarn("Container element wasn't found");c._element=c._getElement(),t.appendChild(c._element)}c._defineButton()}),_defineProperty(this,"_defineButton",function(){c._btn=c._element.querySelector("button[type=submit]"),c._btn||c._showWarn("Button element wasn't found")}),_defineProperty(this,"_getElement",function(){var e=c._createElement("button",{type:"submit",class:"countdowntimer__submit-btn"});e.textContent=c.button_text;var t=c._createElement("div",{class:"countdowntimer"});return t.appendChild(e),t}),_defineProperty(this,"_defineEventListeners",function(){c._btn.addEventListener("click",function(){c._submitting||!0===c.beforeSubmit(c)&&c.onSubmit()})}),_defineProperty(this,"beforeSubmit",function(){return window.confirm(c.submit_verify_message)}),_defineProperty(this,"onSubmit",function(){c.post_url?c._submitting||(c._submitting=!0,fetch(c.post_url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cat:c.cat,uuid:c.uuid})}).then(function(e){c.onSubmitSuccess&&c.onSubmitSuccess(e),c.getTimer()}).catch(c.onSubmitError).finally(function(){c._submitting=!1})):c._showWarn("post_url property wasn't defined")}),_defineProperty(this,"show",function(){c._element.style.visibility="visible"}),_defineProperty(this,"hide",function(){c._element.style.visibility="hidden"}),_defineProperty(this,"getTimer",function(){c.timer_url?c._getting_timer||(c._getting_timer=!0,fetch("".concat(c.timer_url,"/").concat(c.uuid,"?cat=").concat(c.cat)).then(function(e){return e.json()}).then(c._setUpTimer).catch(c.onGetTimerError).finally(function(){c._getting_timer=!1})):c._showWarn("timer_url property wasn't defined")}),_defineProperty(this,"_setUpTimer",function(e){var t,n=null==e?void 0:null===(t=e.assessment)||void 0===t?void 0:t.seconds_remaining;c.secondsRemaining=n,n&&"number"==typeof n&&(c._seconds_remaining=n,c.startTimer(n))}),_defineProperty(this,"_callbackInterval",function(){c._seconds_remaining--,c._seconds_remaining<=c.warning_threshold&&!c._warning_message_is_shown&&(c.onShowWarning(),c._warning_message_is_shown=!0),c._seconds_remaining<=c.alert_threshold&&!c._alert_message_is_shown&&(c.onShowAlert(),c._alert_message_is_shown=!0),c._seconds_remaining<=0&&c.stopTimer()}),_defineProperty(this,"startTimer",function(){c._interval_id=setInterval(c._callbackInterval,1e3)}),_defineProperty(this,"pauseTimer",function(){clearInterval(c._interval_id),c._interval_id=null}),_defineProperty(this,"stopTimer",function(){clearInterval(c._interval_id),c._interval_id=null,c.onStopTimer&&c.onStopTimer(),c._warning_message_is_shown=!1,c._alert_message_is_shown=!1}),_defineProperty(this,"_createElement",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=document.createElement(e);return Object.keys(t).forEach(function(e){n.setAttribute(e,t[e])}),n}),_defineProperty(this,"_showWarn",function(e){return console&&console.warn("CountdownTimer: ".concat(e))}),_defineProperty(this,"_showError",function(e){return console&&console.error("CountdownTimer: ",error)}),this._element=f.customElement,this.hide_on_start=null!==(t=f.hide_on_start)&&void 0!==t?t:this.hide_on_start,this.button_text=null!==(n=f.button_text)&&void 0!==n?n:this.button_text,this.beforeSubmit=null!==(i=f.beforeSubmit)&&void 0!==i?i:this.beforeSubmit,this.submit_verify_message=null!==(r=f.submit_verify_message)&&void 0!==r?r:this.submit_verify_message,this.post_url=f.post_url,this.post_data=null!==(o=f.post_data)&&void 0!==o?o:this.post_data,this.cat=f.cat,this.uuid=f.uuid,this.onSubmitSuccess=f.onSubmitSuccess,this.onSubmitError=null!==(s=f.onSubmitError)&&void 0!==s?s:this.onSubmitError,this.timer_url=f.timer_url,this.onGetTimerError=null!==(_=f.onGetTimerError)&&void 0!==_?_:this.onGetTimerError,this.warning_threshold=null!==(a=f.warning_threshold)&&void 0!==a?a:this.warning_threshold,this.warning_message=null!==(l=f.warning_message)&&void 0!==l?l:this.warning_message,this.onShowWarning=null!==(h=f.onShowWarning)&&void 0!==h?h:this.onShowWarning,this.alert_threshold=null!==(u=f.alert_threshold)&&void 0!==u?u:this.alert_threshold,this.alert_message=null!==(d=f.alert_message)&&void 0!==d?d:this.alert_message,this.onShowAlert=null!==(m=f.onShowAlert)&&void 0!==m?m:this.onShowAlert,this.onStopTimer=f.onStopTimer,this._defineElements(f.container),this._btn&&(!0===this.hide_on_start&&this.hide(),this._defineEventListeners())};